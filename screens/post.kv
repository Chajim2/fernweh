# screens/single_post.kv
#:import dp kivy.metrics.dp
#:import TEXT utils.loading.TEXT
#:import PRIMARY utils.loading.PRIMARY
#:import ACCENT utils.loading.ACCENT
#:import SECONDARY utils.loading.SECONDARY

<PostScreen>:
    name: 'single_post'
    canvas.before:
        Color:
            rgba: PRIMARY
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(10)

        # Header
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            Label:
                text: root.username_text
                font_name: "Bold"
                font_size: dp(18)
                color: TEXT
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                size_hint_x: 0.7
            Label:
                text: root.date_text
                font_name: "Regular"
                font_size: dp(14)
                color: TEXT
                halign: 'right'
                valign: 'middle'
                text_size: self.width, None
                size_hint_x: 0.3

        # Content
        BoxLayout:
            id: content_container
            orientation: 'vertical'
            size_hint_y: 0.7

            ScrollView:
                bar_width: dp(10)
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(10)
                    spacing: dp(10)

                    Label:
                        text: root.post_text
                        font_name: "Regular"
                        color: TEXT
                        font_size: dp(16)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None

                    Label:
                        text: root.emotions_text
                        font_name: "Regular"
                        color: TEXT
                        font_size: dp(14)
                        size_hint_y: None
                        height: self.texture_size[1]
                        text_size: self.width, None
                    
                    # Comments section
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(150)
                        spacing: dp(10)
                        
                        Label:
                            text: "Comments"
                            font_name: "Bold"
                            color: TEXT
                            font_size: dp(16)
                            size_hint_y: None
                            height: dp(30)
                            halign: 'left'
                            valign: 'middle'
                            text_size: self.width, None
                        
                        # Comments list
                        ScrollView:
                            size_hint_y: None
                            height: dp(70)
                            bar_width: dp(10)
                            BoxLayout:
                                id: comments_container
                                orientation: 'vertical'
                                size_hint_y: None
                                height: self.minimum_height
                                spacing: dp(5)
                        
                        # Comment input
                        BoxLayout:
                            size_hint_y: None
                            height: dp(40)
                            spacing: dp(5)
                            
                            TextInput:
                                id: comment_input
                                font_name: "Regular"
                                multiline: True
                                size_hint_x: 0.8
                                background_color: SECONDARY
                                foreground_color: TEXT
                                cursor_color: TEXT
                                padding: [dp(10), dp(10)]
                                font_size: dp(16)
                                size_hint_y: None
                                height: dp(40)
                            
                            Button:
                                text: "Post"
                                font_name: "Bold"
                                size_hint_x: 0.1
                                background_color: 0, 0, 0, 0
                                canvas.before:
                                    Color:
                                        rgba: PRIMARY
                                    Rectangle: 
                                        pos: self.pos
                                        size: self.size
                                    Color:
                                        rgba: ACCENT
                                    Line:
                                        width: 2
                                        rounded_rectangle: (self.x, self.y, self.width, self.height, 10, 10)
                                color: TEXT
                                font_size: dp(14)
                                on_release: root.submit_comment()

        # Footer
        Button:
            text: 'Back to History'
            font_name: "Bold"
            size_hint_y: None
            height: dp(50)
            background_color: ACCENT
            color: TEXT
            font_size: dp(16)
            on_release: root.go_back()